(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{1420:function(e,t,r){"use strict";r.r(t);var n=r(1),i=r(0),a=r(470),o=r(802);var s,d=r(140),u=new Map,l=function(e){return e?function(e,t){var r=[];return Object(o.a)(e,{any:function(e){t(e)&&r.push(e)}}),r}(e,function(e){return"media"===e.type}).reduce(function(e,t){if(t.attrs){var r=t.attrs,n=r.type,i=r.url,a=r.id;"file"===n&&a?e.push({mediaItemType:"file",id:a}):"external"===n&&i&&e.push({mediaItemType:"external-image",dataURI:i,name:i})}return e},[]):[]},c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={},t.renderLoadingCard=function(){var e=t.props.cardDimensions;return i.createElement(d.c,{dimensions:e})},t.getOnCardClickCallback=function(e){var r=t.props.eventHandlers;if(r&&r.media&&r.media.onClick)return function(t,n){var i=t.mediaItemDetails&&"video"===t.mediaItemDetails.mediaType;!(e&&i)&&r&&r.media&&r.media.onClick&&r.media.onClick(t,n)}},t}return n.__extends(t,e),t.prototype.componentDidMount=function(){return n.__awaiter(this,void 0,void 0,function(){var e,t,r,i,a,o,s,d;return n.__generator(this,function(c){switch(c.label){case 0:return e=this.props,t=e.rendererContext,r=e.mediaProvider,i=e.id,a=e.url,o=e.collection,r?[4,r]:[2];case 1:return[4,c.sent().viewContext];case 2:return s=c.sent(),d=i&&u.has(i)||a&&u.has(a),t&&t.adDoc&&!d&&l(t.adDoc).forEach(function(e){"file"===e.mediaItemType?u.set(e.id,n.__assign({},e,{collectionName:o})):"external-image"===e.mediaItemType&&u.set(e.dataURI,e)}),this.setState({context:s}),[2]}})})},t.prototype.componentWillUnmount=function(){var e=this.props,t=e.id,r=e.url;t?u.delete(t):r&&u.delete(r)},t.prototype.renderExternal=function(e){var t=this.state.context,r=this.props,n=r.cardDimensions,a=r.resizeMode,o=r.appearance,s=r.url,l=r.imageStatus,c=r.disableOverlay;if("loading"===l||!s)return this.renderLoadingCard();var m={dataURI:s,name:s,mediaItemType:"external-image"};return i.createElement(d.a,{context:t,identifier:m,dimensions:n,appearance:o,resizeMode:a,disableOverlay:c,shouldOpenMediaViewer:e,mediaViewerDataSource:{list:Array.from(u.values())}})},t.prototype.render=function(){var e=this.state.context,t=this.props,r=t.id,n=t.type,a=t.collection,o=t.occurrenceKey,s=t.cardDimensions,l=t.resizeMode,c=t.rendererAppearance,m=t.disableOverlay,p=t.useInlinePlayer,h="mobile"===c,f=!h&&(void 0===p||p),v=this.getOnCardClickCallback(f),g=!h&&!v;if("external"===n)return this.renderExternal(g);if("link"===n)return null;if(!e||!r)return this.renderLoadingCard();if(!r||"file"!==n)return i.createElement(d.b,{dimensions:s});var y={id:r,mediaItemType:"file",collectionName:a,occurrenceKey:o};return i.createElement(d.a,{identifier:y,context:e,dimensions:s,onClick:v,resizeMode:l,isLazy:!h,disableOverlay:m,useInlinePlayer:f,shouldOpenMediaViewer:g,mediaViewerDataSource:{list:Array.from(u.values())}})},t}(i.Component),m=(s=c,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={imageStatus:"loading"},t.onLoad=function(){t.setState({imageStatus:"complete"});var e=t.props.onExternalImageLoaded;e&&t.img&&e({width:t.img.naturalWidth,height:t.img.naturalHeight})},t.onError=function(){t.setState({imageStatus:"error"})},t}return n.__extends(t,e),t.prototype.componentDidMount=function(){this.fetchImage(this.props)},t.prototype.componentWillReceiveProps=function(e){e.url!==this.props.url&&(this.setState({imageStatus:"loading"}),this.fetchImage(e))},t.prototype.componentWillUnmount=function(){this.img&&(this.img.removeEventListener("load",this.onLoad),this.img.removeEventListener("error",this.onError),this.img=null)},t.prototype.fetchImage=function(e){var t=e.url;t&&(this.img||(this.img=new Image,this.img.addEventListener("load",this.onLoad),this.img.addEventListener("error",this.onError)),this.img.src=t)},t.prototype.render=function(){var e=this.state.imageStatus;return i.createElement(s,n.__assign({},this.props,{imageStatus:e}))},t}(i.Component)),p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.renderCard=function(e){void 0===e&&(e={});var r=e.mediaProvider;return i.createElement(m,n.__assign({mediaProvider:r},t.props))},t}return n.__extends(t,e),t.prototype.render=function(){var e=this.props.providers;return e?i.createElement(a.a,{providers:["mediaProvider"],providerFactory:e,renderNode:this.renderCard}):this.renderCard()},t}(i.PureComponent);t.default=p}}]);
//# sourceMappingURL=@atlaskit-internal-renderer-node_Media.e93c9d5f.chunk.js.map