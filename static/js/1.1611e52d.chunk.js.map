{"version":3,"sources":["../node_modules/@atlaskit/media-picker/popup/config.js","../node_modules/@atlaskit/media-ui/imageMetaData/imageOrientationUtil.js","../node_modules/@atlaskit/media-picker/util/getPreviewFromImage.js","../node_modules/@atlaskit/media-picker/service/newUploadServiceImpl.js","../node_modules/@atlaskit/media-picker/util/getPreviewFromBlob.js","../node_modules/@atlaskit/media-picker/components/localUpload.js","../node_modules/eventemitter2/lib/eventemitter2.js","../node_modules/video-snapshot/dist/index.js","../node_modules/@atlaskit/media-picker/popup/domain/source-file.js","../node_modules/@atlaskit/media-picker/domain/progress.js","../node_modules/@atlaskit/media-picker/util/handleError.js","../node_modules/@atlaskit/media-picker/service/types.js","../node_modules/@atlaskit/media-store/upload-controller.js","../node_modules/@atlaskit/media-picker/util/eventEmitter.js","../node_modules/@atlaskit/media-picker/components/component.js","../node_modules/@atlaskit/media-ui/util.js","../node_modules/@atlaskit/media-ui/imageMetaData/types.js","../node_modules/@atlaskit/media-ui/imageMetaData/parseJPEG.js","../node_modules/@atlaskit/media-ui/imageMetaData/parsePNG.js","../node_modules/@atlaskit/media-ui/imageMetaData/metatags.js","../node_modules/@atlaskit/media-ui/imageMetaData/parsePNGXMP.js","../node_modules/@atlaskit/media-ui/imageMetaData/index.js"],"names":["__webpack_require__","d","__webpack_exports__","RECENTS_COLLECTION","isRotated","getCssFromImageOrientation","ORIENT_TRANSFORMS","1","2","3","4","5","6","7","8","orientation","newUploadServiceImpl_NewUploadServiceImpl","NewUploadServiceImpl","tenantContext","tenantUploadParams","shouldCopyFileToRecents","_this","this","emit","event","payload","emitter","onFileSuccess","cancellableFileUpload","fileId","tslib_es6","mediaFile","details","_a","copyFileToUsersCollection","catch","console","log","file","id","public","cancel","releaseCancellableFile","onFileProgress","portion","size","progress","domain_progress","creationDate","Date","now","toJSON","onFileError","mediaErrorName","error","description","Error","message","name","eventemitter2","cancellableFilesUploads","config","tenantAuthProvider","authProvider","userAuthProvider","tenantMediaStore","media_store","userMediaStore","userContext","media_core","create","prototype","setUploadParams","uploadParams","createUploadController","upload_controller","addFiles","files","addFilesWithSource","map","source","types","LocalUpload","length","context","collection","popup_config","touchFileDescriptors","i","push","v4_default","occurrenceKey","promisedTouchFiles","touchFiles","cancellableFileUploads","fileWithSource","userUpfrontId","userOccurrenceKey","deferredUploadId","then","touchedFiles","touchedFile","created","find","uploadId","uploadableFile","content","mimeType","type","uploadableUpfrontIds","controller","observable","upload","upfrontId","Promise","resolve","tenantOccurrenceKey","options","createFile","response","data","abort","subscription","subscribe","next","state","status","unsubscribe","_error","set","tenantObservable","pipe","Object","mediaFiles","emitPreviews","keys","forEach","key","on","listener","off","mediaType","getMediaTypeFromFile","devicePixelRatio","fileInfo","imageInfo","width","height","scaleFactor","label","util","sent","imageMetaData","dimensions","getPreviewFromImage","PastedScreenshot","window","undefined","preview","reject","src","img_1","snapshoter","URL","createObjectURL","Image","onload","revokeObjectURL","onerror","dist_default","a","getDimensions","end","getPreviewFromBlob_getPreviewFromBlob","sourceFileId","sourceCollection","collectionName","auth","body","sourceFile","owner","source_file","params","copyFileWithToken","localUpload_LocalUploadComponent","_super","LocalUploadComponent","call","onFilesAdded","emitUploadsStart","onFilePreviewUpdate","emitUploadPreviewUpdate","onFileUploading","emitUploadProgress","onFileConverting","emitUploadProcessing","onFileConverted","emitUploadEnd","onUploadError","emitUploadError","uploadService","uniqueIdentifier","component","process","__WEBPACK_AMD_DEFINE_RESULT__","isArray","Array","obj","toString","defaultMaxListeners","init","_events","_conf","configure","conf","delimiter","_maxListeners","maxListeners","wildcard","newListener","verboseMemoryLeak","listenerTree","logPossibleMemoryLeak","count","eventName","errorMsg","emitWarning","e","trace","EventEmitter","searchListenerTree","handlers","tree","leaf","len","branch","xTree","xxTree","isolatedBranch","endReached","listeners","typeLength","currentType","nextType","_listeners","hasOwnProperty","concat","**","EventEmitter2","setMaxListeners","n","once","fn","_once","prependOnceListener","prepend","_many","many","ttl","prependMany","self","apply","arguments","_origin","_on","args","l","j","handler","al","_all","slice","ns","split","emitAsync","promises","all","prependListener","onAny","_onAny","prependAny","addListener","unshift","shift","warned","leafs","iLeaf","position","splice","recursivelyGarbageCollect","root","Function","offAny","fns","removeListener","removeAllListeners","eventNames","listenerCount","listenersAny","exports","module","__awaiter","thisArg","_arguments","P","generator","fulfilled","value","step","rejected","result","done","__generator","f","y","t","g","_","trys","ops","verb","throw","return","Symbol","iterator","v","op","TypeError","pop","defineProperty","isSafari","navigator","test","userAgent","VideoSnapshot","blob","loadVideo","time","video","document","createElement","preload","videoUrl","muted","play","currentTime","duration","getSmartTime","addEventListener","timeupdateHandler","removeEventListener","pause","videoWidth","videoHeight","url","takeSnapshot","canvas","getContext","drawImage","toDataURL","revoke","start","middle","default","mapAuthToSourceFileOwner","_atlaskit_media_core__WEBPACK_IMPORTED_MODULE_0__","clientId","token","baseUrl","SmartMediaProgress","_util_handleError__WEBPACK_IMPORTED_MODULE_0__","startTime","measureTime","isValidSize","isValidProgress","isValidStartTime","isValidMeasureTime","get","enumerable","configurable","overallTime","expectedFinishTime","absolute","max","timeLeft","handleError","alias","errorMessage","stack","LocalFileSource","UploadController","setAbort","abortFunction","eventEmitter_GenericEventEmitter","GenericEventEmitter","component_UploadComponent","UploadComponent","fileDetails","getFileInfo","fileToArrayBuffer","loadImage","tslib__WEBPACK_IMPORTED_MODULE_0__","_b","_c","reader","FileReader","readAsDataURL","array","Uint8Array","readAsArrayBuffer","img","ImageType","SupportedImageMetaTag","ExifOrientation","top-left","top-right","bottom-right","bottom-left","left-top","right-top","right-bottom","left-bottom","XResolution","YResolution","readJPEGExifMetaData","module_1","bind","parseMetaData","tags_1","exif","getAll","numerator","pngChunksExtract","readPNGXMPMetaData","buffer","parsePNGChunks","chunks","iTXt","pHYs","chunk","dv","PixelPerUnitX","PixelPerUnitY","String","fromCharCode","DataView","getUint8","getUint32","readImageMetaTags","PNG","xmpMetaData","metadata","tags","match","tag","name_1","parseXMPMetaData","JPEG","getImageInfo","getOrientation","Orientation","imageMetaData_XResolution","DPI_WEB_BASELINE","readImageMetaData","scaleFactorFromFilename","trim","parseFloat","getScaleFactorFromFile","Math","round","getMetaTagNumericValue","getScaleFactor","imageMetaData_getOrientationFromTags","tagValue","numericValue","parseInt","isNaN","defaultValue","num","naturalWidth","naturalHeight","isImageRotated","PixelXDimension","imageOrientationUtil"],"mappings":"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","file":"static/js/1.1611e52d.chunk.js","sourcesContent":["export var RECENTS_COLLECTION = 'recents';","var ORIENT_TRANSFORMS = {\n  1: 'none',\n  2: 'rotateY(180deg)',\n  3: 'rotate(180deg)',\n  4: 'rotate(180deg) rotateY(180deg)',\n  5: 'rotate(270deg) rotateY(180deg)',\n  6: 'rotate(90deg)',\n  7: 'rotate(90deg) rotateY(180deg)',\n  8: 'rotate(270deg)'\n};\n/**\n * Returns true if image rotated 90 or 270 degrees (on it's side)\n */\n\nexport var isRotated = function isRotated(orientation) {\n  return orientation >= 5;\n};\nexport var getCssFromImageOrientation = function getCssFromImageOrientation(orientation) {\n  return ORIENT_TRANSFORMS[orientation];\n};","import * as tslib_1 from \"tslib\";\nimport { getImageInfo, getFileInfo } from '@atlaskit/media-ui';\nexport function getPreviewFromImage(file, devicePixelRatio) {\n  return tslib_1.__awaiter(this, void 0, void 0, function () {\n    var fileInfo, imageInfo, width, height, scaleFactor, preview;\n    return tslib_1.__generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          return [4\n          /*yield*/\n          , getFileInfo(file)];\n\n        case 1:\n          fileInfo = _a.sent();\n          return [4\n          /*yield*/\n          , getImageInfo(fileInfo)];\n\n        case 2:\n          imageInfo = _a.sent();\n\n          if (imageInfo === null) {\n            return [2\n            /*return*/\n            , {\n              file: file\n            }];\n          } else {\n            width = imageInfo.width, height = imageInfo.height, scaleFactor = imageInfo.scaleFactor;\n            preview = {\n              file: file,\n              dimensions: {\n                width: width,\n                height: height\n              },\n              scaleFactor: devicePixelRatio || scaleFactor\n            };\n            return [2\n            /*return*/\n            , preview];\n          }\n\n          return [2\n          /*return*/\n          ];\n      }\n    });\n  });\n}\nexport var SCALE_FACTOR_DEFAULT = 1;","import * as tslib_1 from \"tslib\";\nimport uuidV4 from 'uuid/v4';\nimport { getMediaTypeFromMimeType, ContextFactory, fileStreamsCache } from '@atlaskit/media-core';\nimport { MediaStore, UploadController } from '@atlaskit/media-store';\nimport { EventEmitter2 } from 'eventemitter2';\nimport { map } from 'rxjs/operators/map';\nimport { RECENTS_COLLECTION } from '../popup/config';\nimport { mapAuthToSourceFileOwner } from '../popup/domain/source-file';\nimport { getPreviewFromImage } from '../util/getPreviewFromImage';\nimport { SmartMediaProgress } from '../domain/progress';\nimport { LocalFileSource } from '../service/types';\nimport { getPreviewFromBlob } from '../util/getPreviewFromBlob';\n\nvar NewUploadServiceImpl =\n/** @class */\nfunction () {\n  function NewUploadServiceImpl(tenantContext, tenantUploadParams, shouldCopyFileToRecents) {\n    var _this = this;\n\n    this.tenantContext = tenantContext;\n    this.tenantUploadParams = tenantUploadParams;\n    this.shouldCopyFileToRecents = shouldCopyFileToRecents;\n\n    this.emit = function (event, payload) {\n      _this.emitter.emit(event, payload);\n    };\n\n    this.onFileSuccess = function (cancellableFileUpload, fileId) {\n      return tslib_1.__awaiter(_this, void 0, void 0, function () {\n        var mediaFile, details;\n\n        var _this = this;\n\n        return tslib_1.__generator(this, function (_a) {\n          mediaFile = cancellableFileUpload.mediaFile;\n          this.copyFileToUsersCollection(fileId) // tslint:disable-next-line:no-console\n          .catch(console.log); // We intentionally swallow these errors\n\n          this.emit('file-converting', {\n            file: mediaFile\n          });\n          details = {\n            id: fileId\n          };\n          this.emit('file-converted', {\n            file: mediaFile,\n            public: details\n          });\n\n          cancellableFileUpload.cancel = function () {\n            _this.releaseCancellableFile(mediaFile);\n          };\n\n          return [2\n          /*return*/\n          ];\n        });\n      });\n    };\n\n    this.onFileProgress = function (_a, portion) {\n      var mediaFile = _a.mediaFile,\n          file = _a.file;\n      var size = file.size;\n      var progress = new SmartMediaProgress(size, size * portion, mediaFile.creationDate, Date.now());\n\n      _this.emit('file-uploading', {\n        file: mediaFile,\n        progress: progress.toJSON()\n      });\n    };\n\n    this.onFileError = function (mediaFile, mediaErrorName, error) {\n      _this.releaseCancellableFile(mediaFile);\n\n      if (error === 'canceled') {\n        // Specific error coming from chunkinator via rejected fileId promise.\n        // We do not want to trigger error in this case.\n        return;\n      }\n\n      var description = error instanceof Error ? error.message : error;\n\n      _this.emit('file-upload-error', {\n        file: mediaFile,\n        error: {\n          fileId: mediaFile.id,\n          description: description,\n          name: mediaErrorName\n        }\n      });\n    };\n\n    this.emitter = new EventEmitter2();\n    this.cancellableFilesUploads = {};\n    var _a = tenantContext.config,\n        tenantAuthProvider = _a.authProvider,\n        userAuthProvider = _a.userAuthProvider; // We need a non user auth store, since we want to create the empty file in the public collection\n\n    this.tenantMediaStore = new MediaStore({\n      authProvider: tenantAuthProvider\n    });\n\n    if (userAuthProvider) {\n      this.userMediaStore = new MediaStore({\n        authProvider: userAuthProvider\n      }); // We need to use the userAuth to upload this file (recents)\n\n      this.userContext = ContextFactory.create({\n        userAuthProvider: userAuthProvider,\n        authProvider: userAuthProvider\n      });\n    }\n  }\n\n  NewUploadServiceImpl.prototype.setUploadParams = function (uploadParams) {\n    this.tenantUploadParams = uploadParams;\n  }; // Used for testing\n\n\n  NewUploadServiceImpl.prototype.createUploadController = function () {\n    return new UploadController();\n  };\n\n  NewUploadServiceImpl.prototype.addFiles = function (files) {\n    this.addFilesWithSource(files.map(function (file) {\n      return {\n        file: file,\n        source: LocalFileSource.LocalUpload\n      };\n    }));\n  };\n\n  NewUploadServiceImpl.prototype.addFilesWithSource = function (files) {\n    var _this = this;\n\n    if (files.length === 0) {\n      return;\n    }\n\n    var creationDate = Date.now();\n\n    var _a = this,\n        userContext = _a.userContext,\n        tenantContext = _a.tenantContext,\n        shouldCopyFileToRecents = _a.shouldCopyFileToRecents;\n\n    var context = shouldCopyFileToRecents ? tenantContext : userContext;\n    var collection = shouldCopyFileToRecents ? this.tenantUploadParams.collection : RECENTS_COLLECTION;\n\n    if (!context) {\n      return;\n    }\n\n    var touchFileDescriptors = [];\n\n    for (var i = 0; i < files.length; i++) {\n      touchFileDescriptors.push({\n        fileId: uuidV4(),\n        occurrenceKey: uuidV4(),\n        collection: collection\n      });\n    }\n\n    var promisedTouchFiles = context.file.touchFiles(touchFileDescriptors, collection);\n    var cancellableFileUploads = files.map(function (fileWithSource, i) {\n      var file = fileWithSource.file,\n          source = fileWithSource.source;\n      var _a = touchFileDescriptors[i],\n          id = _a.fileId,\n          occurrenceKey = _a.occurrenceKey;\n      var deferredUploadId = promisedTouchFiles.then(function (touchedFiles) {\n        var touchedFile = touchedFiles.created.find(function (touchedFile) {\n          return touchedFile.fileId === id;\n        });\n\n        if (!touchedFile) {\n          throw new Error('Cant retrieve uploadId from result of touch endpoint call');\n        }\n\n        return touchedFile.uploadId;\n      });\n      var uploadableFile = {\n        collection: collection,\n        content: file,\n        name: file.name,\n        mimeType: file.type\n      };\n      var uploadableUpfrontIds = {\n        id: id,\n        occurrenceKey: occurrenceKey,\n        deferredUploadId: deferredUploadId\n      };\n\n      var controller = _this.createUploadController();\n\n      var observable = context.file.upload(uploadableFile, controller, uploadableUpfrontIds);\n      var userUpfrontId;\n      var userOccurrenceKey;\n      var upfrontId = Promise.resolve(id);\n\n      if (!shouldCopyFileToRecents) {\n        var tenantOccurrenceKey = uuidV4();\n        var collection_1 = _this.tenantUploadParams.collection;\n        var options = {\n          collection: collection_1,\n          occurrenceKey: tenantOccurrenceKey\n        }; // We want to create an empty file in the tenant collection\n        // TODO [MS-1355]: using context.file.touchFiles instead of createFile will speed up things\n        // since we can lookup the id in the cache without wait for this to finish\n\n        upfrontId = _this.tenantMediaStore.createFile(options).then(function (response) {\n          return response.data.id;\n        });\n        userUpfrontId = Promise.resolve(id);\n        userOccurrenceKey = Promise.resolve(occurrenceKey);\n      }\n\n      var mediaFile = {\n        id: id,\n        upfrontId: upfrontId,\n        userUpfrontId: userUpfrontId,\n        userOccurrenceKey: userOccurrenceKey,\n        name: file.name,\n        size: file.size,\n        creationDate: creationDate,\n        type: file.type,\n        occurrenceKey: occurrenceKey\n      };\n      var cancellableFileUpload = {\n        mediaFile: mediaFile,\n        file: file,\n        source: source,\n        cancel: function cancel() {\n          // we can't do \"cancellableFileUpload.cancel = controller.abort\" because will change the \"this\" context\n          controller.abort();\n        }\n      };\n      var subscription = observable.subscribe({\n        next: function next(state) {\n          if (state.status === 'uploading') {\n            _this.onFileProgress(cancellableFileUpload, state.progress);\n          }\n\n          if (state.status === 'processing') {\n            subscription.unsubscribe();\n\n            _this.onFileSuccess(cancellableFileUpload, id);\n          }\n        },\n        error: function error(_error) {\n          _this.onFileError(mediaFile, 'upload_fail', _error);\n        }\n      });\n      _this.cancellableFilesUploads[id] = cancellableFileUpload; // Save observable in the cache\n      // We want to save the observable without collection too, due consumers using cards without collection.\n\n      fileStreamsCache.set(id, observable);\n      upfrontId.then(function (id) {\n        // We assign the tenant id to the observable to not emit user id instead\n        var tenantObservable = observable.pipe(map(function (file) {\n          return tslib_1.__assign({}, file, {\n            id: id\n          });\n        }));\n        fileStreamsCache.set(id, tenantObservable);\n      });\n      return cancellableFileUpload;\n    });\n    var mediaFiles = cancellableFileUploads.map(function (cancellableFileUpload) {\n      return cancellableFileUpload.mediaFile;\n    });\n    this.emit('files-added', {\n      files: mediaFiles\n    });\n    this.emitPreviews(cancellableFileUploads);\n  };\n\n  NewUploadServiceImpl.prototype.cancel = function (id) {\n    var _this = this;\n\n    if (id) {\n      var cancellableFileUpload = this.cancellableFilesUploads[id];\n\n      if (cancellableFileUpload && cancellableFileUpload.cancel) {\n        cancellableFileUpload.cancel();\n      }\n    } else {\n      Object.keys(this.cancellableFilesUploads).forEach(function (key) {\n        var cancellableFileUpload = _this.cancellableFilesUploads[key];\n\n        if (cancellableFileUpload.cancel) {\n          cancellableFileUpload.cancel();\n        }\n      });\n    }\n  };\n\n  NewUploadServiceImpl.prototype.on = function (event, listener) {\n    this.emitter.on(event, listener);\n  };\n\n  NewUploadServiceImpl.prototype.off = function (event, listener) {\n    this.emitter.off(event, listener);\n  };\n\n  NewUploadServiceImpl.prototype.emitPreviews = function (cancellableFileUploads) {\n    var _this = this;\n\n    cancellableFileUploads.forEach(function (cancellableFileUpload) {\n      var file = cancellableFileUpload.file,\n          mediaFile = cancellableFileUpload.mediaFile,\n          source = cancellableFileUpload.source;\n\n      var mediaType = _this.getMediaTypeFromFile(file);\n\n      if (mediaType === 'image') {\n        getPreviewFromImage(file, source === LocalFileSource.PastedScreenshot ? window.devicePixelRatio : undefined).then(function (preview) {\n          _this.emit('file-preview-update', {\n            file: mediaFile,\n            preview: preview\n          });\n        });\n      } else {\n        getPreviewFromBlob(file, mediaType).then(function (preview) {\n          _this.emit('file-preview-update', {\n            file: mediaFile,\n            preview: preview\n          });\n        });\n      }\n    });\n  };\n\n  NewUploadServiceImpl.prototype.getMediaTypeFromFile = function (file) {\n    var type = file.type;\n    return getMediaTypeFromMimeType(type);\n  };\n\n  NewUploadServiceImpl.prototype.releaseCancellableFile = function (mediaFile) {\n    delete this.cancellableFilesUploads[mediaFile.id];\n  }; // This method copies the file from the \"tenant collection\" to the \"user collection\" (recents).\n  // that means we need \"tenant auth\" as input and \"user auth\" as output\n\n\n  NewUploadServiceImpl.prototype.copyFileToUsersCollection = function (sourceFileId) {\n    var _a = this,\n        shouldCopyFileToRecents = _a.shouldCopyFileToRecents,\n        userMediaStore = _a.userMediaStore,\n        tenantUploadParams = _a.tenantUploadParams;\n\n    if (!shouldCopyFileToRecents || !userMediaStore) {\n      return Promise.resolve();\n    }\n\n    var sourceCollection = tenantUploadParams.collection;\n    var tenantAuthProvider = this.tenantContext.config.authProvider;\n    return tenantAuthProvider({\n      collectionName: sourceCollection\n    }).then(function (auth) {\n      var body = {\n        sourceFile: {\n          id: sourceFileId,\n          collection: sourceCollection,\n          owner: tslib_1.__assign({}, mapAuthToSourceFileOwner(auth))\n        }\n      };\n      var params = {\n        collection: RECENTS_COLLECTION\n      };\n      return userMediaStore.copyFileWithToken(body, params);\n    });\n  };\n\n  return NewUploadServiceImpl;\n}();\n\nexport { NewUploadServiceImpl };","var _this = this;\n\nimport * as tslib_1 from \"tslib\";\nimport VideoSnapshot from 'video-snapshot';\nexport var getPreviewFromBlob = function getPreviewFromBlob(file, mediaType) {\n  return new Promise(function (resolve, reject) {\n    return tslib_1.__awaiter(_this, void 0, void 0, function () {\n      var src, img_1, snapshoter, dimensions, preview;\n      return tslib_1.__generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            src = URL.createObjectURL(file);\n            if (!(mediaType === 'image')) return [3\n            /*break*/\n            , 1];\n            img_1 = new Image();\n            img_1.src = src;\n\n            img_1.onload = function () {\n              var dimensions = {\n                width: img_1.width,\n                height: img_1.height\n              };\n              var preview = {\n                file: file,\n                dimensions: dimensions,\n                scaleFactor: 1\n              };\n              URL.revokeObjectURL(src);\n              resolve(preview);\n            };\n\n            img_1.onerror = reject;\n            return [3\n            /*break*/\n            , 4];\n\n          case 1:\n            if (!(mediaType === 'video')) return [3\n            /*break*/\n            , 3];\n            snapshoter = new VideoSnapshot(file);\n            return [4\n            /*yield*/\n            , snapshoter.getDimensions()];\n\n          case 2:\n            dimensions = _a.sent();\n            preview = {\n              file: file,\n              dimensions: dimensions,\n              scaleFactor: 1\n            };\n            snapshoter.end();\n            resolve(preview);\n            return [3\n            /*break*/\n            , 4];\n\n          case 3:\n            resolve({\n              file: file\n            });\n            _a.label = 4;\n\n          case 4:\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  });\n};","import * as tslib_1 from \"tslib\";\nimport { UploadComponent } from './component';\nimport { NewUploadServiceImpl } from '../service/newUploadServiceImpl';\n\nvar LocalUploadComponent =\n/** @class */\nfunction (_super) {\n  tslib_1.__extends(LocalUploadComponent, _super);\n\n  function LocalUploadComponent(context, config) {\n    var _this = _super.call(this) || this;\n\n    _this.onFilesAdded = function (_a) {\n      var files = _a.files;\n\n      _this.emitUploadsStart(files);\n    };\n\n    _this.onFilePreviewUpdate = function (_a) {\n      var file = _a.file,\n          preview = _a.preview;\n\n      _this.emitUploadPreviewUpdate(file, preview);\n    };\n\n    _this.onFileUploading = function (_a) {\n      var file = _a.file,\n          progress = _a.progress;\n\n      _this.emitUploadProgress(file, progress);\n    };\n\n    _this.onFileConverting = function (_a) {\n      var file = _a.file;\n\n      _this.emitUploadProcessing(file);\n    };\n\n    _this.onFileConverted = function (payload) {\n      _this.emitUploadEnd(payload.file, payload.public);\n    };\n\n    _this.onUploadError = function (_a) {\n      var file = _a.file,\n          error = _a.error;\n\n      _this.emitUploadError(file, error);\n    };\n\n    var tenantUploadParams = config.uploadParams;\n    _this.context = context;\n    var _a = config.shouldCopyFileToRecents,\n        shouldCopyFileToRecents = _a === void 0 ? true : _a;\n    _this.uploadService = new NewUploadServiceImpl(_this.context, tenantUploadParams, shouldCopyFileToRecents);\n    _this.config = config;\n\n    _this.uploadService.on('files-added', _this.onFilesAdded);\n\n    _this.uploadService.on('file-preview-update', _this.onFilePreviewUpdate);\n\n    _this.uploadService.on('file-uploading', _this.onFileUploading);\n\n    _this.uploadService.on('file-converting', _this.onFileConverting);\n\n    _this.uploadService.on('file-converted', _this.onFileConverted);\n\n    _this.uploadService.on('file-upload-error', _this.onUploadError);\n\n    return _this;\n  }\n\n  LocalUploadComponent.prototype.cancel = function (uniqueIdentifier) {\n    this.uploadService.cancel(uniqueIdentifier);\n  };\n\n  LocalUploadComponent.prototype.setUploadParams = function (uploadParams) {\n    this.uploadService.setUploadParams(uploadParams);\n  };\n\n  return LocalUploadComponent;\n}(UploadComponent);\n\nexport { LocalUploadComponent };","/*!\r\n * EventEmitter2\r\n * https://github.com/hij1nx/EventEmitter2\r\n *\r\n * Copyright (c) 2013 hij1nx\r\n * Licensed under the MIT license.\r\n */\n;\n!function (undefined) {\n  var isArray = Array.isArray ? Array.isArray : function _isArray(obj) {\n    return Object.prototype.toString.call(obj) === \"[object Array]\";\n  };\n  var defaultMaxListeners = 10;\n\n  function init() {\n    this._events = {};\n\n    if (this._conf) {\n      configure.call(this, this._conf);\n    }\n  }\n\n  function configure(conf) {\n    if (conf) {\n      this._conf = conf;\n      conf.delimiter && (this.delimiter = conf.delimiter);\n      this._maxListeners = conf.maxListeners !== undefined ? conf.maxListeners : defaultMaxListeners;\n      conf.wildcard && (this.wildcard = conf.wildcard);\n      conf.newListener && (this.newListener = conf.newListener);\n      conf.verboseMemoryLeak && (this.verboseMemoryLeak = conf.verboseMemoryLeak);\n\n      if (this.wildcard) {\n        this.listenerTree = {};\n      }\n    } else {\n      this._maxListeners = defaultMaxListeners;\n    }\n  }\n\n  function logPossibleMemoryLeak(count, eventName) {\n    var errorMsg = '(node) warning: possible EventEmitter memory ' + 'leak detected. ' + count + ' listeners added. ' + 'Use emitter.setMaxListeners() to increase limit.';\n\n    if (this.verboseMemoryLeak) {\n      errorMsg += ' Event name: ' + eventName + '.';\n    }\n\n    if (typeof process !== 'undefined' && process.emitWarning) {\n      var e = new Error(errorMsg);\n      e.name = 'MaxListenersExceededWarning';\n      e.emitter = this;\n      e.count = count;\n      process.emitWarning(e);\n    } else {\n      console.error(errorMsg);\n\n      if (console.trace) {\n        console.trace();\n      }\n    }\n  }\n\n  function EventEmitter(conf) {\n    this._events = {};\n    this.newListener = false;\n    this.verboseMemoryLeak = false;\n    configure.call(this, conf);\n  }\n\n  EventEmitter.EventEmitter2 = EventEmitter; // backwards compatibility for exporting EventEmitter property\n  //\n  // Attention, function return type now is array, always !\n  // It has zero elements if no any matches found and one or more\n  // elements (leafs) if there are matches\n  //\n\n  function searchListenerTree(handlers, type, tree, i) {\n    if (!tree) {\n      return [];\n    }\n\n    var listeners = [],\n        leaf,\n        len,\n        branch,\n        xTree,\n        xxTree,\n        isolatedBranch,\n        endReached,\n        typeLength = type.length,\n        currentType = type[i],\n        nextType = type[i + 1];\n\n    if (i === typeLength && tree._listeners) {\n      //\n      // If at the end of the event(s) list and the tree has listeners\n      // invoke those listeners.\n      //\n      if (typeof tree._listeners === 'function') {\n        handlers && handlers.push(tree._listeners);\n        return [tree];\n      } else {\n        for (leaf = 0, len = tree._listeners.length; leaf < len; leaf++) {\n          handlers && handlers.push(tree._listeners[leaf]);\n        }\n\n        return [tree];\n      }\n    }\n\n    if (currentType === '*' || currentType === '**' || tree[currentType]) {\n      //\n      // If the event emitted is '*' at this part\n      // or there is a concrete match at this patch\n      //\n      if (currentType === '*') {\n        for (branch in tree) {\n          if (branch !== '_listeners' && tree.hasOwnProperty(branch)) {\n            listeners = listeners.concat(searchListenerTree(handlers, type, tree[branch], i + 1));\n          }\n        }\n\n        return listeners;\n      } else if (currentType === '**') {\n        endReached = i + 1 === typeLength || i + 2 === typeLength && nextType === '*';\n\n        if (endReached && tree._listeners) {\n          // The next element has a _listeners, add it to the handlers.\n          listeners = listeners.concat(searchListenerTree(handlers, type, tree, typeLength));\n        }\n\n        for (branch in tree) {\n          if (branch !== '_listeners' && tree.hasOwnProperty(branch)) {\n            if (branch === '*' || branch === '**') {\n              if (tree[branch]._listeners && !endReached) {\n                listeners = listeners.concat(searchListenerTree(handlers, type, tree[branch], typeLength));\n              }\n\n              listeners = listeners.concat(searchListenerTree(handlers, type, tree[branch], i));\n            } else if (branch === nextType) {\n              listeners = listeners.concat(searchListenerTree(handlers, type, tree[branch], i + 2));\n            } else {\n              // No match on this one, shift into the tree but not in the type array.\n              listeners = listeners.concat(searchListenerTree(handlers, type, tree[branch], i));\n            }\n          }\n        }\n\n        return listeners;\n      }\n\n      listeners = listeners.concat(searchListenerTree(handlers, type, tree[currentType], i + 1));\n    }\n\n    xTree = tree['*'];\n\n    if (xTree) {\n      //\n      // If the listener tree will allow any match for this part,\n      // then recursively explore all branches of the tree\n      //\n      searchListenerTree(handlers, type, xTree, i + 1);\n    }\n\n    xxTree = tree['**'];\n\n    if (xxTree) {\n      if (i < typeLength) {\n        if (xxTree._listeners) {\n          // If we have a listener on a '**', it will catch all, so add its handler.\n          searchListenerTree(handlers, type, xxTree, typeLength);\n        } // Build arrays of matching next branches and others.\n\n\n        for (branch in xxTree) {\n          if (branch !== '_listeners' && xxTree.hasOwnProperty(branch)) {\n            if (branch === nextType) {\n              // We know the next element will match, so jump twice.\n              searchListenerTree(handlers, type, xxTree[branch], i + 2);\n            } else if (branch === currentType) {\n              // Current node matches, move into the tree.\n              searchListenerTree(handlers, type, xxTree[branch], i + 1);\n            } else {\n              isolatedBranch = {};\n              isolatedBranch[branch] = xxTree[branch];\n              searchListenerTree(handlers, type, {\n                '**': isolatedBranch\n              }, i + 1);\n            }\n          }\n        }\n      } else if (xxTree._listeners) {\n        // We have reached the end and still on a '**'\n        searchListenerTree(handlers, type, xxTree, typeLength);\n      } else if (xxTree['*'] && xxTree['*']._listeners) {\n        searchListenerTree(handlers, type, xxTree['*'], typeLength);\n      }\n    }\n\n    return listeners;\n  }\n\n  function growListenerTree(type, listener) {\n    type = typeof type === 'string' ? type.split(this.delimiter) : type.slice(); //\n    // Looks for two consecutive '**', if so, don't add the event at all.\n    //\n\n    for (var i = 0, len = type.length; i + 1 < len; i++) {\n      if (type[i] === '**' && type[i + 1] === '**') {\n        return;\n      }\n    }\n\n    var tree = this.listenerTree;\n    var name = type.shift();\n\n    while (name !== undefined) {\n      if (!tree[name]) {\n        tree[name] = {};\n      }\n\n      tree = tree[name];\n\n      if (type.length === 0) {\n        if (!tree._listeners) {\n          tree._listeners = listener;\n        } else {\n          if (typeof tree._listeners === 'function') {\n            tree._listeners = [tree._listeners];\n          }\n\n          tree._listeners.push(listener);\n\n          if (!tree._listeners.warned && this._maxListeners > 0 && tree._listeners.length > this._maxListeners) {\n            tree._listeners.warned = true;\n            logPossibleMemoryLeak.call(this, tree._listeners.length, name);\n          }\n        }\n\n        return true;\n      }\n\n      name = type.shift();\n    }\n\n    return true;\n  } // By default EventEmitters will print a warning if more than\n  // 10 listeners are added to it. This is a useful default which\n  // helps finding memory leaks.\n  //\n  // Obviously not all Emitters should be limited to 10. This function allows\n  // that to be increased. Set to zero for unlimited.\n\n\n  EventEmitter.prototype.delimiter = '.';\n\n  EventEmitter.prototype.setMaxListeners = function (n) {\n    if (n !== undefined) {\n      this._maxListeners = n;\n      if (!this._conf) this._conf = {};\n      this._conf.maxListeners = n;\n    }\n  };\n\n  EventEmitter.prototype.event = '';\n\n  EventEmitter.prototype.once = function (event, fn) {\n    return this._once(event, fn, false);\n  };\n\n  EventEmitter.prototype.prependOnceListener = function (event, fn) {\n    return this._once(event, fn, true);\n  };\n\n  EventEmitter.prototype._once = function (event, fn, prepend) {\n    this._many(event, 1, fn, prepend);\n\n    return this;\n  };\n\n  EventEmitter.prototype.many = function (event, ttl, fn) {\n    return this._many(event, ttl, fn, false);\n  };\n\n  EventEmitter.prototype.prependMany = function (event, ttl, fn) {\n    return this._many(event, ttl, fn, true);\n  };\n\n  EventEmitter.prototype._many = function (event, ttl, fn, prepend) {\n    var self = this;\n\n    if (typeof fn !== 'function') {\n      throw new Error('many only accepts instances of Function');\n    }\n\n    function listener() {\n      if (--ttl === 0) {\n        self.off(event, listener);\n      }\n\n      return fn.apply(this, arguments);\n    }\n\n    listener._origin = fn;\n\n    this._on(event, listener, prepend);\n\n    return self;\n  };\n\n  EventEmitter.prototype.emit = function () {\n    this._events || init.call(this);\n    var type = arguments[0];\n\n    if (type === 'newListener' && !this.newListener) {\n      if (!this._events.newListener) {\n        return false;\n      }\n    }\n\n    var al = arguments.length;\n    var args, l, i, j;\n    var handler;\n\n    if (this._all && this._all.length) {\n      handler = this._all.slice();\n\n      if (al > 3) {\n        args = new Array(al);\n\n        for (j = 0; j < al; j++) {\n          args[j] = arguments[j];\n        }\n      }\n\n      for (i = 0, l = handler.length; i < l; i++) {\n        this.event = type;\n\n        switch (al) {\n          case 1:\n            handler[i].call(this, type);\n            break;\n\n          case 2:\n            handler[i].call(this, type, arguments[1]);\n            break;\n\n          case 3:\n            handler[i].call(this, type, arguments[1], arguments[2]);\n            break;\n\n          default:\n            handler[i].apply(this, args);\n        }\n      }\n    }\n\n    if (this.wildcard) {\n      handler = [];\n      var ns = typeof type === 'string' ? type.split(this.delimiter) : type.slice();\n      searchListenerTree.call(this, handler, ns, this.listenerTree, 0);\n    } else {\n      handler = this._events[type];\n\n      if (typeof handler === 'function') {\n        this.event = type;\n\n        switch (al) {\n          case 1:\n            handler.call(this);\n            break;\n\n          case 2:\n            handler.call(this, arguments[1]);\n            break;\n\n          case 3:\n            handler.call(this, arguments[1], arguments[2]);\n            break;\n\n          default:\n            args = new Array(al - 1);\n\n            for (j = 1; j < al; j++) {\n              args[j - 1] = arguments[j];\n            }\n\n            handler.apply(this, args);\n        }\n\n        return true;\n      } else if (handler) {\n        // need to make copy of handlers because list can change in the middle\n        // of emit call\n        handler = handler.slice();\n      }\n    }\n\n    if (handler && handler.length) {\n      if (al > 3) {\n        args = new Array(al - 1);\n\n        for (j = 1; j < al; j++) {\n          args[j - 1] = arguments[j];\n        }\n      }\n\n      for (i = 0, l = handler.length; i < l; i++) {\n        this.event = type;\n\n        switch (al) {\n          case 1:\n            handler[i].call(this);\n            break;\n\n          case 2:\n            handler[i].call(this, arguments[1]);\n            break;\n\n          case 3:\n            handler[i].call(this, arguments[1], arguments[2]);\n            break;\n\n          default:\n            handler[i].apply(this, args);\n        }\n      }\n\n      return true;\n    } else if (!this._all && type === 'error') {\n      if (arguments[1] instanceof Error) {\n        throw arguments[1]; // Unhandled 'error' event\n      } else {\n        throw new Error(\"Uncaught, unspecified 'error' event.\");\n      }\n\n      return false;\n    }\n\n    return !!this._all;\n  };\n\n  EventEmitter.prototype.emitAsync = function () {\n    this._events || init.call(this);\n    var type = arguments[0];\n\n    if (type === 'newListener' && !this.newListener) {\n      if (!this._events.newListener) {\n        return Promise.resolve([false]);\n      }\n    }\n\n    var promises = [];\n    var al = arguments.length;\n    var args, l, i, j;\n    var handler;\n\n    if (this._all) {\n      if (al > 3) {\n        args = new Array(al);\n\n        for (j = 1; j < al; j++) {\n          args[j] = arguments[j];\n        }\n      }\n\n      for (i = 0, l = this._all.length; i < l; i++) {\n        this.event = type;\n\n        switch (al) {\n          case 1:\n            promises.push(this._all[i].call(this, type));\n            break;\n\n          case 2:\n            promises.push(this._all[i].call(this, type, arguments[1]));\n            break;\n\n          case 3:\n            promises.push(this._all[i].call(this, type, arguments[1], arguments[2]));\n            break;\n\n          default:\n            promises.push(this._all[i].apply(this, args));\n        }\n      }\n    }\n\n    if (this.wildcard) {\n      handler = [];\n      var ns = typeof type === 'string' ? type.split(this.delimiter) : type.slice();\n      searchListenerTree.call(this, handler, ns, this.listenerTree, 0);\n    } else {\n      handler = this._events[type];\n    }\n\n    if (typeof handler === 'function') {\n      this.event = type;\n\n      switch (al) {\n        case 1:\n          promises.push(handler.call(this));\n          break;\n\n        case 2:\n          promises.push(handler.call(this, arguments[1]));\n          break;\n\n        case 3:\n          promises.push(handler.call(this, arguments[1], arguments[2]));\n          break;\n\n        default:\n          args = new Array(al - 1);\n\n          for (j = 1; j < al; j++) {\n            args[j - 1] = arguments[j];\n          }\n\n          promises.push(handler.apply(this, args));\n      }\n    } else if (handler && handler.length) {\n      handler = handler.slice();\n\n      if (al > 3) {\n        args = new Array(al - 1);\n\n        for (j = 1; j < al; j++) {\n          args[j - 1] = arguments[j];\n        }\n      }\n\n      for (i = 0, l = handler.length; i < l; i++) {\n        this.event = type;\n\n        switch (al) {\n          case 1:\n            promises.push(handler[i].call(this));\n            break;\n\n          case 2:\n            promises.push(handler[i].call(this, arguments[1]));\n            break;\n\n          case 3:\n            promises.push(handler[i].call(this, arguments[1], arguments[2]));\n            break;\n\n          default:\n            promises.push(handler[i].apply(this, args));\n        }\n      }\n    } else if (!this._all && type === 'error') {\n      if (arguments[1] instanceof Error) {\n        return Promise.reject(arguments[1]); // Unhandled 'error' event\n      } else {\n        return Promise.reject(\"Uncaught, unspecified 'error' event.\");\n      }\n    }\n\n    return Promise.all(promises);\n  };\n\n  EventEmitter.prototype.on = function (type, listener) {\n    return this._on(type, listener, false);\n  };\n\n  EventEmitter.prototype.prependListener = function (type, listener) {\n    return this._on(type, listener, true);\n  };\n\n  EventEmitter.prototype.onAny = function (fn) {\n    return this._onAny(fn, false);\n  };\n\n  EventEmitter.prototype.prependAny = function (fn) {\n    return this._onAny(fn, true);\n  };\n\n  EventEmitter.prototype.addListener = EventEmitter.prototype.on;\n\n  EventEmitter.prototype._onAny = function (fn, prepend) {\n    if (typeof fn !== 'function') {\n      throw new Error('onAny only accepts instances of Function');\n    }\n\n    if (!this._all) {\n      this._all = [];\n    } // Add the function to the event listener collection.\n\n\n    if (prepend) {\n      this._all.unshift(fn);\n    } else {\n      this._all.push(fn);\n    }\n\n    return this;\n  };\n\n  EventEmitter.prototype._on = function (type, listener, prepend) {\n    if (typeof type === 'function') {\n      this._onAny(type, listener);\n\n      return this;\n    }\n\n    if (typeof listener !== 'function') {\n      throw new Error('on only accepts instances of Function');\n    }\n\n    this._events || init.call(this); // To avoid recursion in the case that type == \"newListeners\"! Before\n    // adding it to the listeners, first emit \"newListeners\".\n\n    this.emit('newListener', type, listener);\n\n    if (this.wildcard) {\n      growListenerTree.call(this, type, listener);\n      return this;\n    }\n\n    if (!this._events[type]) {\n      // Optimize the case of one listener. Don't need the extra array object.\n      this._events[type] = listener;\n    } else {\n      if (typeof this._events[type] === 'function') {\n        // Change to array.\n        this._events[type] = [this._events[type]];\n      } // If we've already got an array, just add\n\n\n      if (prepend) {\n        this._events[type].unshift(listener);\n      } else {\n        this._events[type].push(listener);\n      } // Check for listener leak\n\n\n      if (!this._events[type].warned && this._maxListeners > 0 && this._events[type].length > this._maxListeners) {\n        this._events[type].warned = true;\n        logPossibleMemoryLeak.call(this, this._events[type].length, type);\n      }\n    }\n\n    return this;\n  };\n\n  EventEmitter.prototype.off = function (type, listener) {\n    if (typeof listener !== 'function') {\n      throw new Error('removeListener only takes instances of Function');\n    }\n\n    var handlers,\n        leafs = [];\n\n    if (this.wildcard) {\n      var ns = typeof type === 'string' ? type.split(this.delimiter) : type.slice();\n      leafs = searchListenerTree.call(this, null, ns, this.listenerTree, 0);\n    } else {\n      // does not use listeners(), so no side effect of creating _events[type]\n      if (!this._events[type]) return this;\n      handlers = this._events[type];\n      leafs.push({\n        _listeners: handlers\n      });\n    }\n\n    for (var iLeaf = 0; iLeaf < leafs.length; iLeaf++) {\n      var leaf = leafs[iLeaf];\n      handlers = leaf._listeners;\n\n      if (isArray(handlers)) {\n        var position = -1;\n\n        for (var i = 0, length = handlers.length; i < length; i++) {\n          if (handlers[i] === listener || handlers[i].listener && handlers[i].listener === listener || handlers[i]._origin && handlers[i]._origin === listener) {\n            position = i;\n            break;\n          }\n        }\n\n        if (position < 0) {\n          continue;\n        }\n\n        if (this.wildcard) {\n          leaf._listeners.splice(position, 1);\n        } else {\n          this._events[type].splice(position, 1);\n        }\n\n        if (handlers.length === 0) {\n          if (this.wildcard) {\n            delete leaf._listeners;\n          } else {\n            delete this._events[type];\n          }\n        }\n\n        this.emit(\"removeListener\", type, listener);\n        return this;\n      } else if (handlers === listener || handlers.listener && handlers.listener === listener || handlers._origin && handlers._origin === listener) {\n        if (this.wildcard) {\n          delete leaf._listeners;\n        } else {\n          delete this._events[type];\n        }\n\n        this.emit(\"removeListener\", type, listener);\n      }\n    }\n\n    function recursivelyGarbageCollect(root) {\n      if (root === undefined) {\n        return;\n      }\n\n      var keys = Object.keys(root);\n\n      for (var i in keys) {\n        var key = keys[i];\n        var obj = root[key];\n        if (obj instanceof Function || typeof obj !== \"object\" || obj === null) continue;\n\n        if (Object.keys(obj).length > 0) {\n          recursivelyGarbageCollect(root[key]);\n        }\n\n        if (Object.keys(obj).length === 0) {\n          delete root[key];\n        }\n      }\n    }\n\n    recursivelyGarbageCollect(this.listenerTree);\n    return this;\n  };\n\n  EventEmitter.prototype.offAny = function (fn) {\n    var i = 0,\n        l = 0,\n        fns;\n\n    if (fn && this._all && this._all.length > 0) {\n      fns = this._all;\n\n      for (i = 0, l = fns.length; i < l; i++) {\n        if (fn === fns[i]) {\n          fns.splice(i, 1);\n          this.emit(\"removeListenerAny\", fn);\n          return this;\n        }\n      }\n    } else {\n      fns = this._all;\n\n      for (i = 0, l = fns.length; i < l; i++) {\n        this.emit(\"removeListenerAny\", fns[i]);\n      }\n\n      this._all = [];\n    }\n\n    return this;\n  };\n\n  EventEmitter.prototype.removeListener = EventEmitter.prototype.off;\n\n  EventEmitter.prototype.removeAllListeners = function (type) {\n    if (arguments.length === 0) {\n      !this._events || init.call(this);\n      return this;\n    }\n\n    if (this.wildcard) {\n      var ns = typeof type === 'string' ? type.split(this.delimiter) : type.slice();\n      var leafs = searchListenerTree.call(this, null, ns, this.listenerTree, 0);\n\n      for (var iLeaf = 0; iLeaf < leafs.length; iLeaf++) {\n        var leaf = leafs[iLeaf];\n        leaf._listeners = null;\n      }\n    } else if (this._events) {\n      this._events[type] = null;\n    }\n\n    return this;\n  };\n\n  EventEmitter.prototype.listeners = function (type) {\n    if (this.wildcard) {\n      var handlers = [];\n      var ns = typeof type === 'string' ? type.split(this.delimiter) : type.slice();\n      searchListenerTree.call(this, handlers, ns, this.listenerTree, 0);\n      return handlers;\n    }\n\n    this._events || init.call(this);\n    if (!this._events[type]) this._events[type] = [];\n\n    if (!isArray(this._events[type])) {\n      this._events[type] = [this._events[type]];\n    }\n\n    return this._events[type];\n  };\n\n  EventEmitter.prototype.eventNames = function () {\n    return Object.keys(this._events);\n  };\n\n  EventEmitter.prototype.listenerCount = function (type) {\n    return this.listeners(type).length;\n  };\n\n  EventEmitter.prototype.listenersAny = function () {\n    if (this._all) {\n      return this._all;\n    } else {\n      return [];\n    }\n  };\n\n  if (typeof define === 'function' && define.amd) {\n    // AMD. Register as an anonymous module.\n    define(function () {\n      return EventEmitter;\n    });\n  } else if (typeof exports === 'object') {\n    // CommonJS\n    module.exports = EventEmitter;\n  } else {\n    // Browser global.\n    window.EventEmitter2 = EventEmitter;\n  }\n}();","\"use strict\";\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : new P(function (resolve) {\n        resolve(result.value);\n      }).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nvar __generator = this && this.__generator || function (thisArg, body) {\n  var _ = {\n    label: 0,\n    sent: function sent() {\n      if (t[0] & 1) throw t[1];\n      return t[1];\n    },\n    trys: [],\n    ops: []\n  },\n      f,\n      y,\n      t,\n      g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n\n    while (_) {\n      try {\n        if (f = 1, y && (t = y[op[0] & 2 ? \"return\" : op[0] ? \"throw\" : \"next\"]) && !(t = t.call(y, op[1])).done) return t;\n        if (y = 0, t) op = [0, t.value];\n\n        switch (op[0]) {\n          case 0:\n          case 1:\n            t = op;\n            break;\n\n          case 4:\n            _.label++;\n            return {\n              value: op[1],\n              done: false\n            };\n\n          case 5:\n            _.label++;\n            y = op[1];\n            op = [0];\n            continue;\n\n          case 7:\n            op = _.ops.pop();\n\n            _.trys.pop();\n\n            continue;\n\n          default:\n            if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n              _ = 0;\n              continue;\n            }\n\n            if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n              _.label = op[1];\n              break;\n            }\n\n            if (op[0] === 6 && _.label < t[1]) {\n              _.label = t[1];\n              t = op;\n              break;\n            }\n\n            if (t && _.label < t[2]) {\n              _.label = t[2];\n\n              _.ops.push(op);\n\n              break;\n            }\n\n            if (t[2]) _.ops.pop();\n\n            _.trys.pop();\n\n            continue;\n        }\n\n        op = body.call(thisArg, _);\n      } catch (e) {\n        op = [6, e];\n        y = 0;\n      } finally {\n        f = t = 0;\n      }\n    }\n\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar isSafari = typeof navigator !== 'undefined' && /^((?!chrome|android).)*safari/i.test(navigator.userAgent);\n\nvar VideoSnapshot = function () {\n  function VideoSnapshot(blob) {\n    var _this = this;\n\n    this.loadVideo = function (time) {\n      if (time === void 0) {\n        time = 0;\n      }\n\n      return new Promise(function (resolve) {\n        var video = document.createElement('video');\n        video.preload = 'metadata';\n        video.src = _this.videoUrl;\n        video.muted = true;\n\n        if (time === 0) {\n          video.play();\n        } else {\n          if (typeof time === 'number') {\n            video.currentTime = time;\n          } else if (typeof time === 'string') {\n            var duration = video.duration;\n            video.currentTime = _this.getSmartTime(time, duration);\n          }\n\n          if (isSafari) {\n            video.play();\n          }\n        }\n\n        video.addEventListener('timeupdate', function timeupdateHandler() {\n          video.removeEventListener('timeupdate', timeupdateHandler);\n          video.pause();\n          resolve(video);\n        });\n      });\n    };\n\n    this.getDimensions = function () {\n      return __awaiter(_this, void 0, void 0, function () {\n        var video;\n        return __generator(this, function (_a) {\n          switch (_a.label) {\n            case 0:\n              return [4, this.loadVideo()];\n\n            case 1:\n              video = _a.sent();\n              return [2, {\n                width: video.videoWidth,\n                height: video.videoHeight\n              }];\n          }\n        });\n      });\n    };\n\n    var url = URL.createObjectURL(blob);\n    this.videoUrl = url;\n  }\n\n  VideoSnapshot.prototype.takeSnapshot = function (time) {\n    return __awaiter(this, void 0, void 0, function () {\n      var video, canvas, context, dataURL;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4, this.loadVideo(time)];\n\n          case 1:\n            video = _a.sent();\n            canvas = document.createElement('canvas');\n            canvas.width = video.videoWidth;\n            canvas.height = video.videoHeight;\n            context = canvas.getContext('2d');\n\n            if (!context) {\n              throw new Error('error creating canvas context');\n            }\n\n            context.drawImage(video, 0, 0, canvas.width, canvas.height);\n            dataURL = canvas.toDataURL();\n            return [2, dataURL];\n        }\n      });\n    });\n  };\n\n  VideoSnapshot.prototype.end = function () {\n    this.revoke();\n  };\n\n  VideoSnapshot.prototype.revoke = function () {\n    URL.revokeObjectURL(this.videoUrl);\n  };\n\n  VideoSnapshot.prototype.getSmartTime = function (time, duration) {\n    if (duration === void 0) {\n      duration = 0;\n    }\n\n    var smartTimes = {\n      start: 0,\n      middle: duration / 2,\n      end: duration\n    };\n    return smartTimes[time];\n  };\n\n  return VideoSnapshot;\n}();\n\nexports.default = VideoSnapshot;","import { isClientBasedAuth } from '@atlaskit/media-core';\nexport function mapAuthToSourceFileOwner(auth) {\n  if (isClientBasedAuth(auth)) {\n    return {\n      id: auth.clientId,\n      token: auth.token,\n      baseUrl: auth.baseUrl\n    };\n  } else {\n    return auth;\n  }\n}","// TODO these classes are deprecated and will be removed as part of MSW-691\nimport { handleError } from '../util/handleError';\n\nvar SmartMediaProgress =\n/** @class */\nfunction () {\n  function SmartMediaProgress(size, progress, startTime, measureTime) {\n    this.size = size;\n    this.progress = progress;\n    this.startTime = startTime;\n    this.measureTime = measureTime;\n\n    if (!SmartMediaProgress.isValidSize(size)) {\n      handleError('wrong_file_size', 'Passed file size is incorrect.');\n      return;\n    }\n\n    if (!SmartMediaProgress.isValidProgress(size, progress)) {\n      handleError('wrong_progress', 'The progress format is incorrect.');\n      return;\n    }\n\n    if (!SmartMediaProgress.isValidStartTime(startTime)) {\n      handleError('wrong_start_time', 'The progress start time has incorrect format.');\n      return;\n    }\n\n    if (!SmartMediaProgress.isValidMeasureTime(startTime, measureTime)) {\n      handleError('wrong_measure_time', 'The progress measure time has incorrect format.');\n      return;\n    }\n\n    this.size = size;\n    this.progress = progress;\n    this.startTime = startTime;\n    this.measureTime = measureTime;\n  }\n\n  Object.defineProperty(SmartMediaProgress.prototype, \"absolute\", {\n    get: function get() {\n      return this.progress;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(SmartMediaProgress.prototype, \"portion\", {\n    get: function get() {\n      return this.progress / this.size;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(SmartMediaProgress.prototype, \"max\", {\n    get: function get() {\n      return this.size;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(SmartMediaProgress.prototype, \"overallTime\", {\n    get: function get() {\n      return (this.measureTime - this.startTime) / this.portion;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(SmartMediaProgress.prototype, \"expectedFinishTime\", {\n    get: function get() {\n      return this.startTime + this.overallTime;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(SmartMediaProgress.prototype, \"timeLeft\", {\n    get: function get() {\n      return this.expectedFinishTime - this.measureTime;\n    },\n    enumerable: true,\n    configurable: true\n  });\n\n  SmartMediaProgress.prototype.toJSON = function () {\n    return {\n      absolute: this.absolute,\n      portion: this.portion,\n      max: this.max,\n      overallTime: this.overallTime,\n      expectedFinishTime: this.expectedFinishTime,\n      timeLeft: this.timeLeft\n    };\n  };\n\n  SmartMediaProgress.isValidSize = function (size) {\n    return typeof size === 'number' && size > 0;\n  };\n\n  SmartMediaProgress.isValidProgress = function (size, progress) {\n    return SmartMediaProgress.isValidSize(size) && typeof progress === 'number' && progress >= 0 && progress <= size;\n  };\n\n  SmartMediaProgress.isValidStartTime = function (startTime) {\n    return typeof startTime === 'number' && startTime > 0;\n  };\n\n  SmartMediaProgress.isValidMeasureTime = function (startTime, measureTime) {\n    return SmartMediaProgress.isValidStartTime(startTime) && typeof measureTime === 'number' && measureTime >= startTime;\n  };\n\n  return SmartMediaProgress;\n}();\n\nexport { SmartMediaProgress };","export var handleError = function handleError(alias, description) {\n  var stackTrace = Error().stack || '';\n  var descr = description || '';\n  var errorMessage = alias + \": \" + descr + \" \\n \" + stackTrace; // tslint:disable-next-line:no-console\n\n  console.error(errorMessage);\n};","export var MAX_FILE_SIZE_FOR_PREVIEW = 10e6; // 10 MB\n\nexport var LocalFileSource;\n\n(function (LocalFileSource) {\n  LocalFileSource[LocalFileSource[\"PastedFile\"] = 0] = \"PastedFile\";\n  LocalFileSource[LocalFileSource[\"PastedScreenshot\"] = 1] = \"PastedScreenshot\";\n  LocalFileSource[LocalFileSource[\"LocalUpload\"] = 2] = \"LocalUpload\";\n})(LocalFileSource || (LocalFileSource = {}));","var UploadController =\n/** @class */\nfunction () {\n  function UploadController() {}\n\n  UploadController.prototype.setAbort = function (abortFunction) {\n    this.abortFunction = abortFunction;\n  };\n\n  UploadController.prototype.abort = function () {\n    if (this.abortFunction) {\n      this.abortFunction();\n    }\n  };\n\n  return UploadController;\n}();\n\nexport { UploadController };","import { EventEmitter2 } from 'eventemitter2';\n\nvar GenericEventEmitter =\n/** @class */\nfunction () {\n  function GenericEventEmitter() {\n    this.emitter = new EventEmitter2({\n      wildcard: true\n    });\n  }\n\n  GenericEventEmitter.prototype.once = function (event, listener) {\n    this.emitter.once(event, listener);\n  };\n\n  GenericEventEmitter.prototype.on = function (event, listener) {\n    this.emitter.on(event, listener);\n  };\n\n  GenericEventEmitter.prototype.onAny = function (listener) {\n    this.emitter.onAny(listener);\n  };\n\n  GenericEventEmitter.prototype.addListener = function (event, listener) {\n    this.emitter.addListener(event, listener);\n  };\n\n  GenericEventEmitter.prototype.off = function (event, listener) {\n    this.emitter.off(event, listener);\n  };\n\n  GenericEventEmitter.prototype.removeListener = function (event, handler) {\n    this.emitter.removeListener(event, handler);\n  };\n\n  GenericEventEmitter.prototype.removeAllListeners = function (event) {\n    // We want to explicitly call removeAllListeners without any argument if event is undefined, otherwise will EventEmitter fail\n    if (event === undefined) {\n      this.emitter.removeAllListeners();\n    } else {\n      this.emitter.removeAllListeners(event);\n    }\n  };\n\n  GenericEventEmitter.prototype.emit = function (event, payload) {\n    return this.emitter.emit(event, payload);\n  };\n\n  return GenericEventEmitter;\n}();\n\nexport { GenericEventEmitter };","import * as tslib_1 from \"tslib\";\nimport { GenericEventEmitter } from '../util/eventEmitter';\n\nvar UploadComponent =\n/** @class */\nfunction (_super) {\n  tslib_1.__extends(UploadComponent, _super);\n\n  function UploadComponent() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  UploadComponent.prototype.emitUploadsStart = function (files) {\n    this.emit('uploads-start', {\n      files: files\n    });\n  };\n\n  UploadComponent.prototype.emitUploadProgress = function (file, progress) {\n    this.emit('upload-status-update', {\n      file: file,\n      progress: progress\n    });\n  };\n\n  UploadComponent.prototype.emitUploadPreviewUpdate = function (file, preview) {\n    this.emit('upload-preview-update', {\n      file: file,\n      preview: preview\n    });\n  };\n\n  UploadComponent.prototype.emitUploadProcessing = function (file) {\n    this.emit('upload-processing', {\n      file: file\n    });\n  };\n\n  UploadComponent.prototype.emitUploadEnd = function (file, fileDetails) {\n    this.emit('upload-end', {\n      file: file,\n      public: fileDetails\n    });\n  };\n\n  UploadComponent.prototype.emitUploadError = function (file, error) {\n    this.emit('upload-error', {\n      file: file,\n      error: error\n    });\n  };\n\n  return UploadComponent;\n}(GenericEventEmitter);\n\nexport { UploadComponent };","import * as tslib_1 from \"tslib\";\nexport function dataURItoFile(dataURI, filename) {\n  if (filename === void 0) {\n    filename = 'untitled';\n  }\n\n  if (dataURI.length === 0) {\n    throw new Error('dataURI not found');\n  } // convert base64/URLEncoded data component to raw binary data held in a string\n\n\n  var dataURIParts = dataURI.split(',');\n  var byteString = dataURIParts[0].indexOf('base64') >= 0 ? atob(dataURIParts[1]) : decodeURIComponent(dataURIParts[1]); // separate out the mime component\n\n  var mimeString;\n\n  try {\n    mimeString = dataURI.split(',')[0].split(':')[1].split(';')[0];\n  } catch (e) {\n    // https://stackoverflow.com/questions/1176022/unknown-file-type-mime\n    mimeString = 'application/octet-stream';\n  } // write the bytes of the string to a typed array\n\n\n  var intArray = new Uint8Array(byteString.length);\n\n  for (var i = 0; i < byteString.length; i++) {\n    intArray[i] = byteString.charCodeAt(i);\n  }\n\n  var blob = new Blob([intArray], {\n    type: mimeString\n  });\n\n  try {\n    return new File([blob], filename, {\n      type: mimeString\n    });\n  } catch (e) {\n    // IE11 does not allow the File constructor (yay!)\n    // we get around this by decorating the blob instance with File properties\n    // effectively casting up from Blob to File.\n    var ie11File = blob;\n    var date = new Date();\n    ie11File.lastModified = date.getTime();\n    ie11File.lastModifiedDate = date;\n    ie11File.name = filename;\n    ie11File.webkitRelativePath = '';\n    return ie11File;\n  }\n}\nexport function fileToDataURI(blob) {\n  return new Promise(function (resolve, reject) {\n    var reader = new FileReader();\n    reader.addEventListener('load', function () {\n      var result = reader.result;\n\n      if (typeof result === 'string') {\n        resolve(result);\n      } else if (result === null) {\n        reject();\n      }\n    });\n    reader.addEventListener('error', reject);\n    reader.readAsDataURL(blob);\n  });\n}\nexport function getFileInfo(file, src) {\n  return tslib_1.__awaiter(this, void 0, void 0, function () {\n    var _a, _b;\n\n    return tslib_1.__generator(this, function (_c) {\n      switch (_c.label) {\n        case 0:\n          _a = {\n            file: file\n          };\n          _b = src;\n          if (_b) return [3\n          /*break*/\n          , 2];\n          return [4\n          /*yield*/\n          , fileToDataURI(file)];\n\n        case 1:\n          _b = _c.sent();\n          _c.label = 2;\n\n        case 2:\n          return [2\n          /*return*/\n          , (_a.src = _b, _a)];\n      }\n    });\n  });\n}\nexport function getFileInfoFromSrc(src, file) {\n  return tslib_1.__awaiter(this, void 0, void 0, function () {\n    var _a, _b;\n\n    return tslib_1.__generator(this, function (_c) {\n      switch (_c.label) {\n        case 0:\n          _a = {};\n          _b = file;\n          if (_b) return [3\n          /*break*/\n          , 2];\n          return [4\n          /*yield*/\n          , dataURItoFile(src)];\n\n        case 1:\n          _b = _c.sent();\n          _c.label = 2;\n\n        case 2:\n          return [2\n          /*return*/\n          , (_a.file = _b, _a.src = src, _a)];\n      }\n    });\n  });\n}\nexport function fileToArrayBuffer(file) {\n  return new Promise(function (resolve, reject) {\n    var reader = new FileReader();\n    reader.addEventListener('load', function () {\n      var array = new Uint8Array(reader.result);\n      resolve(array);\n    });\n    reader.addEventListener('error', reject);\n    reader.readAsArrayBuffer(file);\n  });\n}\nexport function loadImage(src) {\n  return new Promise(function (resolve, reject) {\n    var img = new Image();\n    img.src = src;\n\n    img.onload = function () {\n      resolve(img);\n    };\n\n    img.onerror = reject;\n  });\n}","export var ImageType;\n\n(function (ImageType) {\n  ImageType[\"JPEG\"] = \"image/jpeg\";\n  ImageType[\"PNG\"] = \"image/png\";\n})(ImageType || (ImageType = {}));\n\nexport var SupportedImageMetaTag;\n\n(function (SupportedImageMetaTag) {\n  SupportedImageMetaTag[\"XResolution\"] = \"XResolution\";\n  SupportedImageMetaTag[\"YResolution\"] = \"YResolution\";\n  SupportedImageMetaTag[\"Orientation\"] = \"Orientation\";\n})(SupportedImageMetaTag || (SupportedImageMetaTag = {})); // http://sylvana.net/jpegcrop/exif_orientation.html\n\n\nexport var ExifOrientation = {\n  'top-left': 1,\n  'top-right': 2,\n  'bottom-right': 3,\n  'bottom-left': 4,\n  'left-top': 5,\n  'right-top': 6,\n  'right-bottom': 7,\n  'left-bottom': 8\n};","import * as tslib_1 from \"tslib\";\nimport { SupportedImageMetaTag } from './types';\nvar XResolution = SupportedImageMetaTag.XResolution,\n    YResolution = SupportedImageMetaTag.YResolution;\nvar loadImage;\nexport function readJPEGExifMetaData(file) {\n  var _this = this;\n\n  return new Promise(function (resolve, reject) {\n    return tslib_1.__awaiter(_this, void 0, void 0, function () {\n      var module_1;\n      return tslib_1.__generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            if (!!loadImage) return [3\n            /*break*/\n            , 2];\n            return [4\n            /*yield*/\n            , import('blueimp-load-image')];\n\n          case 1:\n            module_1 = _a.sent();\n            loadImage = module_1.default || module_1;\n            _a.label = 2;\n\n          case 2:\n            loadImage.parseMetaData(file, function (data) {\n              try {\n                var tags_1 = data && data.exif ? data.exif.getAll() : {};\n                Object.keys(tags_1).forEach(function (key) {\n                  var value = tags_1[key];\n\n                  if (typeof value === 'object' && (key === XResolution || key === YResolution) && 'numerator' in value) {\n                    // some test images had this structure, so just take the numerator value to simplify returned value\n                    tags_1[key] = value.numerator;\n                  }\n\n                  if (typeof tags_1[key] === 'number') {\n                    // in case numbers types were auto-converted, keep everything the same between jpeg & png we keep as strings\n                    tags_1[key] = \"\" + tags_1[key];\n                  }\n                });\n                resolve(tags_1);\n              } catch (e) {\n                reject(e);\n              }\n            });\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  });\n}","import * as tslib_1 from \"tslib\";\nimport { fileToArrayBuffer } from '../util';\nvar pngChunksExtract;\nexport function readPNGXMPMetaData(file) {\n  return tslib_1.__awaiter(this, void 0, void 0, function () {\n    var module_1, buffer, chunks;\n    return tslib_1.__generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          if (!!pngChunksExtract) return [3\n          /*break*/\n          , 2];\n          return [4\n          /*yield*/\n          , import('png-chunks-extract')];\n\n        case 1:\n          module_1 = _a.sent();\n          pngChunksExtract = module_1.default || module_1;\n          _a.label = 2;\n\n        case 2:\n          return [4\n          /*yield*/\n          , fileToArrayBuffer(file)];\n\n        case 3:\n          buffer = _a.sent();\n          chunks = pngChunksExtract(buffer);\n          return [4\n          /*yield*/\n          , parsePNGChunks(chunks)];\n\n        case 4:\n          return [2\n          /*return*/\n          , _a.sent()];\n      }\n    });\n  });\n}\nexport function parsePNGChunks(chunks) {\n  return tslib_1.__awaiter(this, void 0, void 0, function () {\n    var iTXt, pHYs, i, chunk, dv, unitSpecifier, PixelPerUnitX, PixelPerUnitY;\n    return tslib_1.__generator(this, function (_a) {\n      iTXt = '';\n      pHYs = {};\n      /**\n       * http://www.libpng.org/pub/png/spec/1.2/PNG-Chunks.html#C.Summary-of-standard-chunks\n       * Order of every chunk is not guaranteed.\n       * And both iTXt and pHYs are Ancillary chunks.\n       */\n\n      for (i = 0; i < chunks.length; ++i) {\n        chunk = chunks[i]; // Must be last\n\n        if (chunk.name === 'IEND') {\n          break;\n        }\n        /**\n         * http://www.libpng.org/pub/png/spec/1.2/PNG-Chunks.html#C.Anc-text\n         * iTXt contains the useful XMP/XML string data of meta tags\n         */\n\n\n        if (chunk.name === 'iTXt') {\n          iTXt = String.fromCharCode.apply(null, chunk.data);\n        }\n        /**\n         * http://www.libpng.org/pub/png/spec/1.2/PNG-Chunks.html#C.pHYs\n         * Pixels per unit, X axis: 4 bytes (unsigned integer)\n         * Pixels per unit, Y axis: 4 bytes (unsigned integer)\n         * Unit specifier:          1 byte  (0: unit is unknown 1: unit is the meter)\n         */\n\n\n        if (chunk.name === 'pHYs') {\n          dv = new DataView(chunk.data.buffer);\n          unitSpecifier = dv.getUint8(8); // meter\n\n          if (unitSpecifier === 1) {\n            PixelPerUnitX = dv.getUint32(0);\n            PixelPerUnitY = dv.getUint32(4);\n            pHYs = {\n              PixelPerUnitX: PixelPerUnitX,\n              PixelPerUnitY: PixelPerUnitY\n            };\n          }\n        }\n      }\n\n      return [2\n      /*return*/\n      , {\n        iTXt: iTXt,\n        pHYs: pHYs\n      }];\n    });\n  });\n}","import * as tslib_1 from \"tslib\";\nimport { ImageType } from './types';\nimport { readJPEGExifMetaData } from './parseJPEG';\nimport { readPNGXMPMetaData } from './parsePNG';\nimport { parseXMPMetaData } from './parsePNGXMP';\nexport function readImageMetaTags(file) {\n  return tslib_1.__awaiter(this, void 0, void 0, function () {\n    var type, _a, iTXt, pHYs, xmpMetaData, e_1;\n\n    return tslib_1.__generator(this, function (_b) {\n      switch (_b.label) {\n        case 0:\n          type = file.type;\n          _b.label = 1;\n\n        case 1:\n          _b.trys.push([1, 6,, 7]);\n\n          if (!(type === ImageType.PNG)) return [3\n          /*break*/\n          , 3];\n          return [4\n          /*yield*/\n          , readPNGXMPMetaData(file)];\n\n        case 2:\n          _a = _b.sent(), iTXt = _a.iTXt, pHYs = _a.pHYs;\n          xmpMetaData = tslib_1.__assign({}, parseXMPMetaData(iTXt), pHYs);\n          return [2\n          /*return*/\n          , xmpMetaData];\n\n        case 3:\n          if (!(file.type === ImageType.JPEG)) return [3\n          /*break*/\n          , 5];\n          return [4\n          /*yield*/\n          , readJPEGExifMetaData(file)];\n\n        case 4:\n          return [2\n          /*return*/\n          , _b.sent()];\n\n        case 5:\n          return [3\n          /*break*/\n          , 7];\n\n        case 6:\n          e_1 = _b.sent();\n          return [3\n          /*break*/\n          , 7];\n\n        case 7:\n          return [2\n          /*return*/\n          , null];\n      }\n    });\n  });\n}","export function parseXMPMetaData(xmpMetaData) {\n  var metadata = {};\n  var tags = xmpMetaData.match(/<(tiff|exif):.+>/gi);\n\n  if (tags) {\n    tags.forEach(function (tag) {\n      var match = tag.match(/<(tiff|exif):([^>]+)>([^<]+)/i);\n\n      if (match) {\n        var name_1 = match[2];\n        metadata[name_1] = match[3];\n      }\n    });\n  }\n\n  return metadata;\n}","import * as tslib_1 from \"tslib\";\nimport { SupportedImageMetaTag, ExifOrientation } from './types';\nimport { readImageMetaTags } from './metatags';\nimport { loadImage } from '../util';\nimport { isRotated } from './imageOrientationUtil';\nvar Orientation = SupportedImageMetaTag.Orientation,\n    XResolution = SupportedImageMetaTag.XResolution; // http://bonfx.com/why-is-the-web-72-dpi-and-print-300-dpi/\n\nvar DPI_WEB_BASELINE = 72;\nexport { ExifOrientation } from './types';\nexport function getImageInfo(fileInfo) {\n  return tslib_1.__awaiter(this, void 0, void 0, function () {\n    var metadata, width, height, tags, scaleFactor;\n    return tslib_1.__generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          return [4\n          /*yield*/\n          , readImageMetaData(fileInfo)];\n\n        case 1:\n          metadata = _a.sent();\n\n          if (!metadata) {\n            return [2\n            /*return*/\n            , null];\n          }\n\n          width = metadata.width, height = metadata.height, tags = metadata.tags;\n          scaleFactor = getScaleFactor(fileInfo.file, tags);\n          return [2\n          /*return*/\n          , {\n            scaleFactor: scaleFactor,\n            width: width,\n            height: height\n          }];\n      }\n    });\n  });\n}\nexport function getScaleFactor(file, tags) {\n  var scaleFactorFromFilename = getScaleFactorFromFile(file);\n\n  if (scaleFactorFromFilename !== null) {\n    return scaleFactorFromFilename;\n  } else if (tags) {\n    /**\n     * Scale Factor is actually a 2D thing, but in practice X & Y are same in 99% cases.\n     * So we are only relying on X axis.\n     */\n    if (typeof tags['PixelPerUnitX'] === 'number') {\n      // 1 inch = 0.0254 meters\n      return Math.round(tags['PixelPerUnitX'] * 0.0254) / DPI_WEB_BASELINE;\n    } else {\n      return getMetaTagNumericValue(tags, XResolution, DPI_WEB_BASELINE) / DPI_WEB_BASELINE;\n    }\n  } else {\n    return 1;\n  }\n}\n\nvar getOrientationFromTags = function getOrientationFromTags(tags) {\n  if (tags && tags[Orientation]) {\n    var tagValue = tags[Orientation];\n\n    if (tagValue) {\n      var numericValue = parseInt(tagValue, 10);\n\n      if (isNaN(numericValue)) {\n        return ExifOrientation[tagValue];\n      }\n\n      return numericValue;\n    }\n  }\n\n  return 1;\n};\n\nexport function getOrientation(file) {\n  return tslib_1.__awaiter(this, void 0, void 0, function () {\n    var tags;\n    return tslib_1.__generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          return [4\n          /*yield*/\n          , readImageMetaTags(file)];\n\n        case 1:\n          tags = _a.sent();\n          return [2\n          /*return*/\n          , getOrientationFromTags(tags)];\n      }\n    });\n  });\n}\nexport function getMetaTagNumericValue(tags, key, defaultValue) {\n  try {\n    var num = parseFloat(\"\" + tags[key]);\n\n    if (!isNaN(num)) {\n      return num;\n    }\n  } catch (e) {//\n  }\n\n  return defaultValue;\n}\nexport function getScaleFactorFromFile(file) {\n  try {\n    // filenames with scale ratio in name take precedence - eg. filename@2x.png\n    var match = file.name.trim().match(/@([0-9\\.]+)x\\.[a-z]{3}$/);\n\n    if (match) {\n      return parseFloat(match[1]);\n    }\n  } catch (e) {// parse problem, return null\n  }\n\n  return null;\n}\nexport function readImageMetaData(fileInfo) {\n  return tslib_1.__awaiter(this, void 0, void 0, function () {\n    var file, src, type, width, height, tags, img, e_1, naturalWidth, naturalHeight, orientation, isImageRotated, data;\n    return tslib_1.__generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          file = fileInfo.file, src = fileInfo.src;\n          type = file.type;\n          width = 0;\n          height = 0;\n          return [4\n          /*yield*/\n          , readImageMetaTags(file)];\n\n        case 1:\n          tags = _a.sent(); // since we're reading metadata anyway, try to get dimensions from there...\n\n          if (tags && tags.PixelXDimension) {\n            width = getMetaTagNumericValue(tags, 'PixelXDimension', 0);\n          }\n\n          if (tags && tags.PixelXDimension) {\n            height = getMetaTagNumericValue(tags, 'PixelYDimension', 0);\n          }\n\n          if (!(width === 0 && height === 0)) return [3\n          /*break*/\n          , 6];\n          img = void 0;\n          _a.label = 2;\n\n        case 2:\n          _a.trys.push([2, 4,, 5]);\n\n          return [4\n          /*yield*/\n          , loadImage(src)];\n\n        case 3:\n          img = _a.sent();\n          return [3\n          /*break*/\n          , 5];\n\n        case 4:\n          e_1 = _a.sent();\n          return [2\n          /*return*/\n          , null];\n\n        case 5:\n          naturalWidth = img.naturalWidth, naturalHeight = img.naturalHeight;\n          width = naturalWidth;\n          height = naturalHeight;\n          _a.label = 6;\n\n        case 6:\n          orientation = getOrientationFromTags(tags);\n          isImageRotated = isRotated(orientation);\n          data = {\n            type: type,\n            width: isImageRotated ? height : width,\n            height: isImageRotated ? width : height,\n            tags: tags\n          };\n          return [2\n          /*return*/\n          , data];\n      }\n    });\n  });\n}\nexport * from './imageOrientationUtil';"],"sourceRoot":""}